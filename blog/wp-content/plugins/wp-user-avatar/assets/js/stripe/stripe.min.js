!function($){(new function(){var e=this,s=!1,t=$("form#ppress_mb_checkout_form"),r=Stripe(ppress_stripe_vars.publishable_key,{locale:ppress_stripe_vars.locale});this.init=function(){window.processCheckoutFlag=!1,$(document).on("ppress_updated_checkout",e.mountCardElement),$(document).on("ppress_update_checkout",e.unmountCardElement),$(document).on("click","#ppress-checkout-button",(function(){window.processCheckoutFlag=!0})),t.on("ppress_checkout_place_order_stripe",e.tokenRequest),t.on("ppress_process_checkout_stripe",e.processCheckout)},this.mountCardElement=function(){0!==$("#ppress-stripe-card-element").length&&(s=r.elements().create("card",ppress_stripe_vars.createCardOptions)).mount("#ppress-stripe-card-element")},this.unmountCardElement=function(){0!==$("#ppress-stripe-card-element").length&&void 0!==s.unmount&&s.destroy()},this.tokenRequest=function(){if(!0===window.processCheckoutFlag)return $("#ppress_stripe_payment_method").remove(),r.createPaymentMethod({type:"card",card:s,billing_details:{name:$("#stripe-card_name").val(),email:$("#ppmb_email").val(),address:{city:$("#stripe_ppress_billing_city").val(),country:$("#stripe_ppress_billing_country").val(),line1:$("#stripe_ppress_billing_address").val(),postal_code:$("#stripe_ppress_billing_postcode").val(),state:$("#stripe_ppress_billing_state").val()}}}).then((function(e){"error"in e&&void 0!==e.error.message?ppressCheckoutForm.createAlertMessage(e.error.message):(window.processCheckoutFlag=!1,t.append('<input id="ppress_stripe_payment_method" type="hidden" name="ppress_stripe_payment_method" value="'+e.paymentMethod.id+'">'),t.submit())})),!1},this.processCheckout=function(e,s,t){var n;if(!0===ppressCheckoutForm.is_var_defined(s.gateway_response)&&(!0===ppressCheckoutForm.is_var_defined(s.gateway_response.latest_invoice)&&!0===ppressCheckoutForm.is_var_defined(s.gateway_response.latest_invoice.payment_intent)&&!0===ppressCheckoutForm.is_var_defined(s.gateway_response.latest_invoice.payment_intent.status)&&"requires_action"===s.gateway_response.latest_invoice.payment_intent.status||!0===ppressCheckoutForm.is_var_defined(s.gateway_response.status)&&"requires_action"===s.gateway_response.status))return n=ppressCheckoutForm.is_var_defined(s.gateway_response.client_secret)?s.gateway_response.client_secret:s.gateway_response.latest_invoice.payment_intent.client_secret,r.confirmCardPayment(n).then((function(e){e.error?ppressCheckoutForm.createAlertMessage(e.error.message):"succeeded"===e.paymentIntent.status&&($(document.body).trigger("ppress_checkout_success",[s,t]),window.location.assign(s.order_success_url))})),!1}}).init()}(jQuery);